//update values for source and target in table temp_links
UPDATE temp_links
SET source = nodes.taxid
FROM nodes
WHERE temp_links.source = nodes.id;

UPDATE temp_links
SET target = nodes.taxid
FROM nodes
WHERE temp_links.target = nodes.id


//create new table links,the data comes from table temp_links 
create table links as
select * from temp_links 
where source in 
(select taxid from nodes where nodes.taxid=temp_links.source) 
and target in 
(select taxid from nodes where nodes.taxid=temp_links.target);


//add new column source_level and insert value from table nodes
alter table links add column source_level varchar(255);

UPDATE links
SET source_level = nodes.taxlevel
FROM nodes
WHERE links.source = nodes.taxid


//add new column target_level and insert value from table nodes
alter table links add column target_level varchar(255);

UPDATE links
SET target_level = nodes.taxlevel
FROM nodes
WHERE links.target = nodes.taxid


//add new column contextId and insert values from table contexts
alter table links add column contextId varchar(255);

UPDATE links
SET contextId = contexts.id
from contexts


//add new column for table links and insert the temp value 0
alter table links add column type integer;

UPDATE links SET type = 0;


//drop id column from table links, because this id is not primary key
alter table links drop column id;

//add primary key for table links, auto increment
alter table links add column id serial primary key;


//drop temp links table
drop table temp_links;


//create index for nodes using name
create index idx_name on nodes (name);



