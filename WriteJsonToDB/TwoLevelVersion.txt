//update values for source and target in table linksb
UPDATE linksb
SET source = nodesb.taxid
FROM nodesb
WHERE linksb.source = nodesb.id;

UPDATE linksb
SET target = nodesb.taxid
FROM nodesb
WHERE linksb.target = nodesb.id


//create new table links,the data comes from table linksb 
create table linksbb as
select * from linksb 
where source in 
(select taxid from nodesb where nodesb.taxid=linksb.source) 
and target in 
(select taxid from nodesb where nodesb.taxid=linksb.target);


//add new column source_level and insert value from table nodesb
alter table linksbb add column entity_1_type varchar(255);

UPDATE linksbb
SET entity_1_type = nodesb.taxlevel
FROM nodesb
WHERE linksbb.source = nodesb.taxid


//add new column target_level and insert value from table nodesb
alter table linksbb add column entity_2_type varchar(255);

UPDATE linksbb
SET entity_2_type = nodesb.taxlevel
FROM nodesb
WHERE linksbb.target = nodesb.taxid


//add new column contextId and insert values from table contexts
alter table linksbb add column contextId varchar(255);

UPDATE linksbb SET contextId = 'C30007'


//add new column for table links and insert the temp value 0
alter table linksbb add column interaction_type varchar(255);

UPDATE linksbb SET interaction_type = 'correlation';

//drop temp linksbb table
drop table linksb;

//change table: add some column and rename some columns
alter table linksbb rename column source_cond to entity_1_name

alter table linksbb rename column target_cond to entity_2_name

UPDATE linksbb
SET entity_1_name = nodesb.name
FROM nodesb
WHERE linksbb.source = nodesb.taxid

UPDATE linksbb
SET entity_2_name = nodesb.name
FROM nodesb
WHERE linksbb.target = nodesb.taxid

alter table linksbb add column habitat_1 varchar(255);

UPDATE linksbb
SET habitat_1 = contexts.body_site
from contexts
where linksbb.contextid=contexts.id;

alter table linksbb add column habitat_2 varchar(255);

UPDATE linksbb
SET habitat_2 = contexts.body_site
from contexts
where linksbb.contextid=contexts.id;


alter table linksbb rename column source to bio_entity_1;

alter table linksbb rename column target to bio_entity_2;


alter table nodesb rename to nodes_leftAn_f;

alter table linksbb rename to links_leftAn_f;

update links_leftAn_f
set bio_entity_1='32644',entity_1_name='unidentified' 
where entity_1_type <> 'family';

update links_leftAn_f 
set bio_entity_2='32644',entity_2_name='unidentified' 
where entity_2_type <> 'family';

update links_leftAn_f
set entity_1_type='family',
entity_2_type='family'

delete from links_leftAn_f
where entity_1_name='unidentified' and entity_2_name='unidentified';


create table links_leftAn_all as 
(select * from links_leftAn_g union all
select * from links_leftAn_f

);


create table links2 as 
(select * from links_mid_all union all
select * from links_anterior_all union all 
select * from links_attached_all union all 
select * from links_buccal_all union all
select * from links_hard_all union all
select * from links_leftAn_all union all
select * from links_leftRe_all union all
select * from links_palatine_all union all
select * from links_posterior_all union all
select * from links_rightAn_all union all
select * from links_rightRe_all union all
select * from links_saliva_all union all
select * from links_stool_all union all
select * from links_subgingival_all union all
select * from links_supragingival_all union all
select * from links_throat_all union all
select * from links_tongue_all union all
select * from links_vaginal_all 
);
