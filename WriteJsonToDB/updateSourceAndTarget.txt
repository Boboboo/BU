//update values for source and target in table linksb
UPDATE linksb
SET source = nodesb.taxid
FROM nodesb
WHERE linksb.source = nodesb.id;

UPDATE linksb
SET target = nodesb.taxid
FROM nodesb
WHERE linksb.target = nodesb.id


//create new table links,the data comes from table linksb 
create table linksbb as
select * from linksb 
where source in 
(select taxid from nodesb where nodesb.taxid=linksb.source) 
and target in 
(select taxid from nodesb where nodesb.taxid=linksb.target);


//add new column source_level and insert value from table nodesb
alter table linksbb add column entity_1_type varchar(255);

UPDATE linksbb
SET entity_1_type = nodesb.taxlevel
FROM nodesb
WHERE linksbb.source = nodesb.taxid


//add new column target_level and insert value from table nodesb
alter table linksbb add column entity_2_type varchar(255);

UPDATE linksbb
SET entity_2_type = nodesb.taxlevel
FROM nodesb
WHERE linksbb.target = nodesb.taxid


//add new column contextId and insert values from table contexts
alter table linksbb add column contextId varchar(255);

UPDATE linksbb SET contextId = 'C30003'


//add new column for table links and insert the temp value 0
alter table linksbb add column interaction_type varchar(255);

UPDATE linksbb SET interaction_type = 'correlation';

//drop temp linksbb table
drop table linksb;


//create index for nodesb using name
create index idx_name on nodesb (name);


//change table: add some column and rename some columns
alter table linksbb rename column source_cond to entity_1_name

alter table linksbb rename column target_cond to entity_2_name

UPDATE linksbb
SET entity_1_name = nodesb.name
FROM nodesb
WHERE linksbb.source = nodesb.taxid

UPDATE linksbb
SET entity_2_name = nodesb.name
FROM nodesb
WHERE linksbb.target = nodesb.taxid

alter table linksbb add column habitat_1 varchar(255);

UPDATE linksbb
SET habitat_1 = contexts.body_site
from contexts
where linksbb.contextid=contexts.id;

alter table linksbb add column habitat_2 varchar(255);

UPDATE linksbb
SET habitat_2 = contexts.body_site
from contexts
where linksbb.contextid=contexts.id;


alter table linksbb rename column source to bio_entity_1;

alter table linksbb rename column target to bio_entity_2;

//drop id column from table linksbb, because this id is not primary key
alter table linksbb drop column id;

//add primary key for table links, auto increment
alter table linksbb add column id serial primary key;

alter table nodesb rename to nodes_attached;

alter table linksbb rename to links_attached;

alter sequence linksbb_id_seq rename to links_attached_id_seq;

update contexts set numbers_of_links=276 where id='C30003';

create table links as 
(select * from links_mid union all
select * from links_anterior union all 
select * from links_attached union all 
select * from links_buccal union all
select * from links_hard union all
select * from links_leftAn union all
select * from links_leftRe union all
select * from links_palatine union all
select * from links_posterior union all
select * from links_rightAn union all
select * from links_saliva union all
select * from links_stool union all
select * from links_subgingival union all
select * from links_supragingival union all
select * from links_throat union all
select * from links_tougue union all
select * from links_vaginal 
);

alter table links drop column id;

//add primary key for table links, auto increment
alter table links add column id serial primary key;